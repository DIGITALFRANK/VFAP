{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Main stack",
  "Parameters": {
		"Environment": {
		  "Description": "The environment type",
		  "Type": "String",
		  "Default": "qa",
		  "AllowedValues": [
			"dev",
			"prod",
			"qa"
		  ],
		  "ConstraintDescription": "must be a dev, test or prod"
		},
		"BusinessOwnerEmail": {
			"Description": "The Business Owner Email",
			"Type": "String",
			"Default": "deepak_lakshmanan1@vfc.com"
		},
		"TechOwnerEmail": {
			"Description": "The Technical Owner Email",
			"Type": "String",
			"Default": "deepak_lakshmanan1@vfc.com"
		},
		"ResourceGroup": {
			"Description": "The ResourceGroup Name",
			"Type": "String",
			"Default": "VFAP:Support"
		},
		"Application": {
			"Description": "The Application Name",
			"Type": "String",
			"Default": "VFAP:DigitalLab"
		},
		"State": {
			"Description": "Cloud watch trigger state",
			"Type": "String",
			"AllowedValues": [
				"ENABLED",
				"DISABLED"
			],
			"Default": "DISABLED"
		},
		"Version":{
			"Description": "Lambda version",
			"Type": "String",
			"Default": "V-1.0.0"
		}	
  },
  "Resources": {
		"IngestionStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" },
				  "Version": { "Ref": "Version" },
				  "State": { "Ref": "State" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/ingest-routine/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"ParamStoreStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/param-store/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"SecretsStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/secrets/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"DynamoDBStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/dynamoDB/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"GlueConnStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/glue-conn/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"RefineStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" },
				  "Version": { "Ref": "Version" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/refine-routine/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"MergeTriggerStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" },
				  "Version": { "Ref": "Version" },
				  "State": { "Ref": "State" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/glue-triggers/merge-trigger/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"CommonTriggerStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" },
				  "Version": { "Ref": "Version" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/glue-triggers/common-trigger/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        },
		"DLGlueJobsStack": {
			  "Type": "AWS::CloudFormation::Stack",
			  "Properties": {
				"Parameters": {
				  "Environment": { "Ref": "Environment" },
				  "ResourceGroup": { "Ref": "ResourceGroup" },
				  "Application": { "Ref": "Application" },
				  "BusinessOwnerEmail": { "Ref": "BusinessOwnerEmail" },
				  "TechOwnerEmail": { "Ref": "TechOwnerEmail" }
				},
				"TemplateURL": "https://s3.amazonaws.com/vf-artifacts-bucket/vfap/transform-routine/templates/template-resolved.json",
                "Tags": [
					  { "Key": "CostCenter", "Value": "118204800" },
					  { "Key": "TechOwnerEmail", "Value": { "Ref": "TechOwnerEmail" } },
					  { "Key": "Environment", "Value": { "Ref": "Environment" } },
					  { "Key": "BusinessOwnerEmail", "Value": { "Ref": "BusinessOwnerEmail" } },
					  { "Key": "ResourceGroup", "Value": { "Ref": "ResourceGroup" } },
					  { "Key": "Application", "Value": { "Ref": "Application" } }
                ]
            }
        }
    }
}