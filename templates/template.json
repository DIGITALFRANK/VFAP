{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Ingest Lambda",
    "Parameters": {
        "EnvironmentType": {
            "Description": "The environment type",
            "Type": "String",
            "Default": "dev",
            "AllowedValues": [
                "dev",
                "prod",
                "qa"
            ],
            "ConstraintDescription": "must be a dev, test or prod"
        }
    },
    "Mappings": {
        "EnvironmentMap": {
            "dev": {
                "VPCID": "",
                "LambdaRole": ""
            },
            "qa": {
                "VPCID": "",
                "LambdaRole": ""
            },
            "prod": {
                "VPCID": "",
                "LambdaRole": ""
            }
        }
    },
    "Resources": {
        "LambdaFunction": {
            "Type" : "AWS::Lambda::Function",
            "Properties": {
                "FunctionName": { "Fn::Join" : [ "-", [ "vf", { "Ref": "EnvironmentType"}, "-sftp-ingest-to-raw" ] ] },
                "Handler": "lambda_function.lambda_handler",
                "Runtime": "python3.7",
                "Description": "unzip files lambda",
                "Code": {
                    "ZipFile": "https://s3.amazonaws.com/vf-artifacts-bucket/end-to-end/vf_ingest/src/param-resolver.zip"
                },
                "MemorySize": 128,
                "Timeout": 60,
                "Role": {
                    "Fn::FindInMap": [
                        "EnvironmentMap",
                        {
                            "Ref": "EnvironmentType"
                        },
                        "LambdaRole"
                    ]
                },
                "Environment": {
                    "Variables": {
                        "GetVPCID": {
                            "Fn::FindInMap": [
                                "EnvironmentMap",
                                {
                                    "Ref": "EnvironmentType"
                                },
                                "VPCID"
                            ]
                        }
                    }
                },
                "Tags": [
                    { "Key": "CostCenter", "Value": "118204800" },
                    { "Key": "TechOwnerEmail", "Value": "DEEPAK_LAKSHMANAN1@VFC.COM" },
                    { "Key": "Environment", "Value": { "Ref": "EnvironmentType" } },
                    { "Key": "BusinessOwnerEmail", "Value": "DEEPAK_LAKSHMANAN1@VFC.COM" },
                    { "Key": "ResourceGroup", "Value": "VFAP:END-TO-END" },
                    { "Key": "Application", "Value": "VFAP:END-TO-END" }
                ]
            }
        }
    }
}
